!function(){function a(a){return"string"==typeof a?a.replace(/[^0-9%]/g,""):a}function b(a){var b,c;if(a&&!a.splice){for(b=[],c=0;!0&&a[c];c++)b[c]=a[c];return b}return a}var c,d,e=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),f=tinymce.makeMap(e.join(",")),g=tinymce.html.Node,h=tinymce.util.JSON;c=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]],tinymce.create("tinymce.plugins.MediaPlugin",{init:function(a,b){function f(b){return b&&"IMG"===b.nodeName&&a.dom.hasClass(b,"mceItemMedia")}var g,i,j,k,l=this,m={};for(l.editor=a,l.url=b,d="",g=0;g<c.length;g++){for(k=c[g][0],j={name:k,clsids:tinymce.explode(c[g][1]||""),mimes:tinymce.explode(c[g][2]||""),codebase:c[g][3]},i=0;i<j.clsids.length;i++)m["clsid:"+j.clsids[i]]=j;for(i=0;i<j.mimes.length;i++)m[j.mimes[i]]=j;m["mceItem"+k]=j,m[k.toLowerCase()]=j,d+=(d?"|":"")+k}tinymce.each(a.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),function(a){var b,c,d;for(a=a.split(/=/),c=tinymce.explode(a[1].toLowerCase()),b=0;b<c.length;b++)d=m[a[0].toLowerCase()],d&&(m[c[b]]=d)}),d=new RegExp("write("+d+")\\(([^)]+)\\)"),l.lookup=m,a.onPreInit.add(function(){a.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]"),a.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(a){for(var b=a.length;b--;)l.objectToImg(a[b])}),a.serializer.addNodeFilter("img",function(a,b,c){for(var d,e=a.length;e--;)d=a[e],-1!==(d.attr("class")||"").indexOf("mceItemMedia")&&l.imgToObject(d,c)})}),a.onInit.add(function(){a.theme&&a.theme.onResolveName&&a.theme.onResolveName.add(function(b,c){"img"===c.name&&a.dom.hasClass(c.node,"mceItemMedia")&&(c.name="media")}),a&&a.plugins.contextmenu&&a.plugins.contextmenu.onContextMenu.add(function(a,b,c){"IMG"===c.nodeName&&-1!==c.className.indexOf("mceItemMedia")&&b.add({title:"media.edit",icon:"media",cmd:"mceMedia"})})}),a.addCommand("mceMedia",function(){var c,d;d=a.selection.getNode(),f(d)&&(c=a.dom.getAttrib(d,"data-mce-json"),c&&(c=h.parse(c),tinymce.each(e,function(b){var e=a.dom.getAttrib(d,b);e&&(c[b]=e)}),c.type=l.getType(d.className).name.toLowerCase())),c||(c={type:"flash",video:{sources:[]},params:{}}),a.windowManager.open({file:b+"/media.htm",width:430+parseInt(a.getLang("media.delta_width",0)),height:500+parseInt(a.getLang("media.delta_height",0)),inline:1},{plugin_url:b,data:c})}),a.addButton("media",{title:"media.desc",cmd:"mceMedia"}),a.onNodeChange.add(function(a,b,c){b.setActive("media",f(c))})},convertUrl:function(a,b){var c=this,d=c.editor,e=d.settings,f=e.url_converter,g=e.url_converter_scope||c;return a?b?d.documentBaseURI.toAbsolute(a):f.call(g,a,"src","object"):a},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(c,d){{var e,f,g,i,j=this,k=j.editor;k.documentBaseURI}if(c.params.src=j.convertUrl(c.params.src,d),f=c.video.attrs,f&&(f.src=j.convertUrl(f.src,d)),f&&(f.poster=j.convertUrl(f.poster,d)),e=b(c.video.sources))for(i=0;i<e.length;i++)e[i].src=j.convertUrl(e[i].src,d);return g=j.editor.dom.create("img",{id:c.id,style:c.style,align:c.align,hspace:c.hspace,vspace:c.vspace,src:j.editor.theme.url+"/img/trans.gif","class":"mceItemMedia mceItem"+j.getType(c.type).name,"data-mce-json":h.serialize(c,"'")}),g.width=c.width=a(c.width||("audio"==c.type?"300":"320")),g.height=c.height=a(c.height||("audio"==c.type?"32":"240")),g},dataToHtml:function(a,b){return this.editor.serializer.serialize(this.dataToImg(a,b),{forced_root_block:"",force_absolute:b})},htmlToData:function(a){var b,c,d;return d={type:"flash",video:{sources:[]},params:{}},b=this.editor.parser.parse(a),c=b.getAll("img")[0],c&&(d=h.parse(c.attr("data-mce-json")),d.type=this.getType(c.attr("class")).name.toLowerCase(),tinymce.each(e,function(a){var b=c.attr(a);b&&(d[a]=b)})),d},getType:function(a){var b,c,d;for(c=tinymce.explode(a," "),b=0;b<c.length;b++)if(d=this.lookup[c[b]])return d},imgToObject:function(c,d){function f(a,b){var c,d,e,f,g;g=z.getParam("flash_video_player_url",y.convertUrl(y.url+"/moxieplayer.swf")),g&&(c=z.documentBaseURI,n.params.src=g,z.getParam("flash_video_player_absvideourl",!0)&&(a=c.toAbsolute(a||"",!0),b=c.toAbsolute(b||"",!0)),e="",d=z.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),tinymce.each(d,function(c,d){c=c.replace(/\$url/,a||""),c=c.replace(/\$poster/,b||""),c.length>0&&(e+=(e?"&":"")+d+"="+escape(c))}),e.length&&(n.params.flashvars=e),f=z.getParam("flash_video_player_params",{allowfullscreen:!0,allowscriptaccess:!0}),tinymce.each(f,function(a,b){n.params[b]=""+a}))}var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=this,z=y.editor;if(n=c.attr("data-mce-json")){if(n=h.parse(n),r=this.getType(c.attr("class")),w=c.attr("data-mce-style"),w||(w=c.attr("style"),w&&(w=z.dom.serializeStyle(z.dom.parseStyle(w,"img")))),n.width=c.attr("width")||n.width,n.height=c.attr("height")||n.height,"Iframe"===r.name){u=new g("iframe",1),tinymce.each(e,function(a){var b=c.attr(a);"class"==a&&b&&(b=b.replace(/mceItem.+ ?/g,"")),b&&b.length>0&&u.attr(a,b)});for(l in n.params)u.attr(l,n.params[l]);return u.attr({style:w,src:n.params.src}),void c.replace(u)}if(this.editor.settings.media_use_script)return u=new g("script",1).attr("type","text/javascript"),m=new g("#text",3),m.value="write"+r.name+"("+h.serialize(tinymce.extend(n.params,{width:c.attr("width"),height:c.attr("height")}))+");",u.append(m),void c.replace(u);if("Video"===r.name&&n.video.sources[0]){for(i=new g("video",1).attr(tinymce.extend({id:c.attr("id"),width:a(c.attr("width")),height:a(c.attr("height")),style:w},n.video.attrs)),n.video.attrs&&(v=n.video.attrs.poster),p=n.video.sources=b(n.video.sources),s=0;s<p.length;s++)/\.mp4$/.test(p[s].src)&&(t=p[s].src);for(p[0].type||(i.attr("src",p[0].src),p.splice(0,1)),s=0;s<p.length;s++)o=new g("source",1).attr(p[s]),o.shortEnded=!0,i.append(o);t?(f(t,v),r=y.getType("flash")):n.params.src=""}if("Audio"===r.name&&n.video.sources[0]){for(x=new g("audio",1).attr(tinymce.extend({id:c.attr("id"),width:a(c.attr("width")),height:a(c.attr("height")),style:w},n.video.attrs)),n.video.attrs&&(v=n.video.attrs.poster),p=n.video.sources=b(n.video.sources),p[0].type||(x.attr("src",p[0].src),p.splice(0,1)),s=0;s<p.length;s++)o=new g("source",1).attr(p[s]),o.shortEnded=!0,x.append(o);n.params.src=""}if("EmbeddedAudio"===r.name){k=new g("embed",1),k.shortEnded=!0,k.attr({id:c.attr("id"),width:a(c.attr("width")),height:a(c.attr("height")),style:w,type:c.attr("type")});for(l in n.params)k.attr(l,n.params[l]);tinymce.each(e,function(a){n[a]&&"type"!=a&&k.attr(a,n[a])}),n.params.src=""}if(n.params.src){/\.flv$/i.test(n.params.src)&&f(n.params.src,""),d&&d.force_absolute&&(n.params.src=z.documentBaseURI.toAbsolute(n.params.src)),j=new g("object",1).attr({id:c.attr("id"),width:a(c.attr("width")),height:a(c.attr("height")),style:w}),tinymce.each(e,function(a){var b=n[a];"class"==a&&b&&(b=b.replace(/mceItem.+ ?/g,"")),b&&"type"!=a&&j.attr(a,b)});for(l in n.params)q=new g("param",1),q.shortEnded=!0,m=n.params[l],"src"===l&&"WindowsMedia"===r.name&&(l="url"),q.attr({name:l,value:m}),j.append(q);if(this.editor.getParam("media_strict",!0))j.attr({data:n.params.src,type:r.mimes[0]});else{j.attr({classid:"clsid:"+r.clsids[0],codebase:r.codebase}),k=new g("embed",1),k.shortEnded=!0,k.attr({id:c.attr("id"),width:a(c.attr("width")),height:a(c.attr("height")),style:w,type:r.mimes[0]});for(l in n.params)k.attr(l,n.params[l]);tinymce.each(e,function(a){n[a]&&"type"!=a&&k.attr(a,n[a])}),j.append(k)}n.object_html&&(m=new g("#text",3),m.raw=!0,m.value=n.object_html,j.append(m)),i&&i.append(j)}i&&n.video_html&&(m=new g("#text",3),m.raw=!0,m.value=n.video_html,i.append(m)),x&&n.video_html&&(m=new g("#text",3),m.raw=!0,m.value=n.video_html,x.append(m));var A=i||x||j||k;A?c.replace(A):c.remove()}},objectToImg:function(b){function c(a){return new tinymce.html.Serializer({inner:!0,validate:!1}).serialize(a)}function i(a,b){return I[(a.attr(b)||"").toLowerCase()]}function j(a){var b=a.replace(/^.*\.([^.]+)$/,"$1");return I[b.toLowerCase()||""]}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I=this.lookup,J=this.editor.settings.url_converter,K=this.editor.settings.url_converter_scope;if(b.parent){if("script"===b.name){if(b.firstChild&&(C=d.exec(b.firstChild.value)),!C)return;B=C[1],A={video:{},params:h.parse(C[2])},r=A.params.width,s=A.params.height}if(A=A||{video:{},params:{}},o=new g("img",1),o.attr({src:this.editor.theme.url+"/img/trans.gif"}),p=b.name,"video"===p||"audio"==p){m=b,k=b.getAll("object")[0],l=b.getAll("embed")[0],r=m.attr("width"),s=m.attr("height"),q=m.attr("id"),A.video={attrs:{},sources:[]},D=A.video.attrs;for(p in m.attributes.map)D[p]=m.attributes.map[p];for(y=b.attr("src"),y&&A.video.sources.push({src:J.call(K,y,"src",b.name)}),z=m.getAll("source"),u=0;u<z.length;u++)y=z[u].remove(),A.video.sources.push({src:J.call(K,y.attr("src"),"src","source"),type:y.attr("type"),media:y.attr("media")});D.poster&&(D.poster=J.call(K,D.poster,"poster",b.name))}if("object"===b.name&&(k=b,l=b.getAll("embed")[0]),"embed"===b.name&&(l=b),"iframe"===b.name&&(n=b,B="Iframe"),k){for(r=r||k.attr("width"),s=s||k.attr("height"),t=t||k.attr("style"),q=q||k.attr("id"),E=E||k.attr("hspace"),F=F||k.attr("vspace"),G=G||k.attr("align"),H=H||k.attr("bgcolor"),A.name=k.attr("name"),x=k.getAll("param"),u=0;u<x.length;u++)w=x[u],p=w.remove().attr("name"),f[p]||(A.params[p]=w.attr("value"));A.params.src=A.params.src||k.attr("data")}if(l){r=r||l.attr("width"),s=s||l.attr("height"),t=t||l.attr("style"),q=q||l.attr("id"),E=E||l.attr("hspace"),F=F||l.attr("vspace"),G=G||l.attr("align"),H=H||l.attr("bgcolor");for(p in l.attributes.map)f[p]||A.params[p]||(A.params[p]=l.attributes.map[p])}if(n){r=a(n.attr("width")),s=a(n.attr("height")),t=t||n.attr("style"),q=n.attr("id"),E=n.attr("hspace"),F=n.attr("vspace"),G=n.attr("align"),H=n.attr("bgcolor"),tinymce.each(e,function(a){o.attr(a,n.attr(a))});for(p in n.attributes.map)f[p]||A.params[p]||(A.params[p]=n.attributes.map[p])}A.params.movie&&(A.params.src=A.params.src||A.params.movie,delete A.params.movie),A.params.src&&(A.params.src=J.call(K,A.params.src,"src","object")),m&&("video"===b.name?B=I.video.name:"audio"===b.name&&(B=I.audio.name)),k&&!B&&(B=(i(k,"clsid")||i(k,"classid")||i(k,"type")||{}).name),l&&!B&&(B=(i(l,"type")||j(A.params.src)||{}).name),l&&"EmbeddedAudio"==B&&(A.params.type=l.attr("type")),b.replace(o),l&&l.remove(),k&&(v=c(k.remove()),v&&(A.object_html=v)),m&&(v=c(m.remove()),v&&(A.video_html=v)),A.hspace=E,A.vspace=F,A.align=G,A.bgcolor=H,o.attr({id:q,"class":"mceItemMedia mceItem"+(B||"Flash"),style:t,width:r||("audio"==b.name?"300":"320"),height:s||("audio"==b.name?"32":"240"),hspace:E,vspace:F,align:G,bgcolor:H,"data-mce-json":h.serialize(A,"'")})}}}),tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)}();
//# sourceMappingURL=editor_plugin.map