var ImageDialog={preInit:function(){var a;tinyMCEPopup.requireLangPack(),(a=tinyMCEPopup.getParam("external_image_list_url"))&&document.write('<script language="javascript" type="text/javascript" src="'+tinyMCEPopup.editor.documentBaseURI.toAbsolute(a)+'"></script>')},init:function(){var a=document.forms[0],b=tinyMCEPopup.editor;document.getElementById("srcbrowsercontainer").innerHTML=getBrowserHTML("srcbrowser","src","image","theme_advanced_image"),isVisible("srcbrowser")&&(document.getElementById("src").style.width="180px"),e=b.selection.getNode(),this.fillFileList("image_list",tinyMCEPopup.getParam("external_image_list","tinyMCEImageList")),"IMG"==e.nodeName&&(a.src.value=b.dom.getAttrib(e,"src"),a.alt.value=b.dom.getAttrib(e,"alt"),a.border.value=this.getAttrib(e,"border"),a.vspace.value=this.getAttrib(e,"vspace"),a.hspace.value=this.getAttrib(e,"hspace"),a.width.value=b.dom.getAttrib(e,"width"),a.height.value=b.dom.getAttrib(e,"height"),a.insert.value=b.getLang("update"),this.styleVal=b.dom.getAttrib(e,"style"),selectByValue(a,"image_list",a.src.value),selectByValue(a,"align",this.getAttrib(e,"align")),this.updateStyle())},fillFileList:function(a,b){var c=tinyMCEPopup.dom,d=c.get(a);b="function"==typeof b?b():window[b],b&&b.length>0?(d.options[d.options.length]=new Option("",""),tinymce.each(b,function(a){d.options[d.options.length]=new Option(a[0],a[1])})):c.remove(c.getParent(a,"tr"))},update:function(){var a,b=document.forms[0],c=b.elements,d=tinyMCEPopup.editor,e={};return tinyMCEPopup.restoreSelection(),""===b.src.value?("IMG"==d.selection.getNode().nodeName&&(d.dom.remove(d.selection.getNode()),d.execCommand("mceRepaint")),void tinyMCEPopup.close()):(d.settings.inline_styles?e.style=this.styleVal:e=tinymce.extend(e,{vspace:c.vspace.value,hspace:c.hspace.value,border:c.border.value,align:getSelectValue(b,"align")}),tinymce.extend(e,{src:b.src.value.replace(/ /g,"%20"),alt:b.alt.value,width:b.width.value,height:b.height.value}),a=d.selection.getNode(),a&&"IMG"==a.nodeName?(d.dom.setAttribs(a,e),tinyMCEPopup.editor.execCommand("mceRepaint"),tinyMCEPopup.editor.focus()):(tinymce.each(e,function(a,b){""===a&&delete e[b]}),d.execCommand("mceInsertContent",!1,tinyMCEPopup.editor.dom.createHTML("img",e),{skip_undo:1}),d.undoManager.add()),void tinyMCEPopup.close())},updateStyle:function(){var a,b=tinyMCEPopup.dom,c={},d=document.forms[0];tinyMCEPopup.editor.settings.inline_styles&&(tinymce.each(tinyMCEPopup.dom.parseStyle(this.styleVal),function(a,b){c[b]=a}),a=getSelectValue(d,"align"),a?"left"==a||"right"==a?(c["float"]=a,delete c["vertical-align"]):(c["vertical-align"]=a,delete c["float"]):(delete c["float"],delete c["vertical-align"]),a=d.border.value,a||"0"==a?c.border="0"==a?"0":a+"px solid black":delete c.border,a=d.hspace.value,a?(delete c.margin,c["margin-left"]=a+"px",c["margin-right"]=a+"px"):(delete c["margin-left"],delete c["margin-right"]),a=d.vspace.value,a?(delete c.margin,c["margin-top"]=a+"px",c["margin-bottom"]=a+"px"):(delete c["margin-top"],delete c["margin-bottom"]),c=tinyMCEPopup.dom.parseStyle(b.serializeStyle(c),"img"),this.styleVal=b.serializeStyle(c,"img"))},getAttrib:function(a,b){var c,d,e=tinyMCEPopup.editor,f=e.dom;if(e.settings.inline_styles)switch(b){case"align":if(c=f.getStyle(a,"float"))return c;if(c=f.getStyle(a,"vertical-align"))return c;break;case"hspace":if(c=f.getStyle(a,"margin-left"),d=f.getStyle(a,"margin-right"),c&&c==d)return parseInt(c.replace(/[^0-9]/g,""));break;case"vspace":if(c=f.getStyle(a,"margin-top"),d=f.getStyle(a,"margin-bottom"),c&&c==d)return parseInt(c.replace(/[^0-9]/g,""));break;case"border":if(c=0,tinymce.each(["top","right","bottom","left"],function(b){return b=f.getStyle(a,"border-"+b+"-width"),!b||b!=c&&0!==c?(c=0,!1):void(b&&(c=b))}),c)return parseInt(c.replace(/[^0-9]/g,""))}return(c=f.getAttrib(a,b))?c:""},resetImageData:function(){var a=document.forms[0];a.width.value=a.height.value=""},updateImageData:function(){var a=document.forms[0],b=ImageDialog;""==a.width.value&&(a.width.value=b.preloadImg.width),""==a.height.value&&(a.height.value=b.preloadImg.height)},getImageData:function(){var a=document.forms[0];this.preloadImg=new Image,this.preloadImg.onload=this.updateImageData,this.preloadImg.onerror=this.resetImageData,this.preloadImg.src=tinyMCEPopup.editor.documentBaseURI.toAbsolute(a.src.value)}};ImageDialog.preInit(),tinyMCEPopup.onInit.add(ImageDialog.init,ImageDialog);