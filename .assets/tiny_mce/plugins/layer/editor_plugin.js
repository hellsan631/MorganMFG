!function(){function a(a){do if(a.className&&-1!=a.className.indexOf("mceItemLayer"))return a;while(a=a.parentNode)}tinymce.create("tinymce.plugins.Layer",{init:function(b){var c=this;c.editor=b,b.addCommand("mceInsertLayer",c._insertLayer,c),b.addCommand("mceMoveForward",function(){c._move(1)}),b.addCommand("mceMoveBackward",function(){c._move(-1)}),b.addCommand("mceMakeAbsolute",function(){c._toggleAbsolute()}),b.addButton("moveforward",{title:"layer.forward_desc",cmd:"mceMoveForward"}),b.addButton("movebackward",{title:"layer.backward_desc",cmd:"mceMoveBackward"}),b.addButton("absolute",{title:"layer.absolute_desc",cmd:"mceMakeAbsolute"}),b.addButton("insertlayer",{title:"layer.insertlayer_desc",cmd:"mceInsertLayer"}),b.onInit.add(function(){b.dom;tinymce.isIE&&b.getDoc().execCommand("2D-Position",!1,!0)}),b.onMouseUp.add(function(b,c){var d=a(c.target);d&&b.dom.setAttrib(d,"data-mce-style","")}),b.onMouseDown.add(function(b,c){var d,e=c.target,f=b.getDoc();tinymce.isGecko&&(a(e)?"on"!==f.designMode&&(f.designMode="on",e=f.body,d=e.parentNode,d.removeChild(e),d.appendChild(e)):"on"==f.designMode&&(f.designMode="off"))}),b.onNodeChange.add(c._nodeChange,c),b.onVisualAid.add(c._visualAid,c)},getInfo:function(){return{longname:"Layer",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/layer",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_nodeChange:function(a,b,c){var d,e;d=this._getParentLayer(c),e=a.dom.getParent(c,"DIV,P,IMG"),e?(b.setDisabled("absolute",0),b.setDisabled("moveforward",!d),b.setDisabled("movebackward",!d),b.setActive("absolute",d&&"absolute"==d.style.position.toLowerCase())):(b.setDisabled("absolute",1),b.setDisabled("moveforward",1),b.setDisabled("movebackward",1))},_visualAid:function(a,b,c){var d=a.dom;tinymce.each(d.select("div,p",b),function(a){/^(absolute|relative|fixed)$/i.test(a.style.position)&&(c?d.addClass(a,"mceItemVisualAid"):d.removeClass(a,"mceItemVisualAid"),d.addClass(a,"mceItemLayer"))})},_move:function(a){var b,c,d=this.editor,e=[],f=this._getParentLayer(d.selection.getNode()),g=-1,h=-1;for(c=[],tinymce.walk(d.getBody(),function(a){1==a.nodeType&&/^(absolute|relative|static)$/i.test(a.style.position)&&c.push(a)},"childNodes"),b=0;b<c.length;b++)e[b]=c[b].style.zIndex?parseInt(c[b].style.zIndex):0,0>g&&c[b]==f&&(g=b);if(0>a){for(b=0;b<e.length;b++)if(e[b]<e[g]){h=b;break}h>-1?(c[g].style.zIndex=e[h],c[h].style.zIndex=e[g]):e[g]>0&&(c[g].style.zIndex=e[g]-1)}else{for(b=0;b<e.length;b++)if(e[b]>e[g]){h=b;break}h>-1?(c[g].style.zIndex=e[h],c[h].style.zIndex=e[g]):c[g].style.zIndex=e[g]+1}d.execCommand("mceRepaint")},_getParentLayer:function(a){return this.editor.dom.getParent(a,function(a){return 1==a.nodeType&&/^(absolute|relative|static)$/i.test(a.style.position)})},_insertLayer:function(){var a=this.editor,b=a.dom,c=b.getPos(b.getParent(a.selection.getNode(),"*")),d=a.getBody();a.dom.add(d,"div",{style:{position:"absolute",left:c.x,top:c.y>20?c.y:20,width:100,height:100},"class":"mceItemVisualAid mceItemLayer"},a.selection.getContent()||a.getLang("layer.content")),tinymce.isIE&&b.setHTML(d,d.innerHTML)},_toggleAbsolute:function(){var a=this.editor,b=this._getParentLayer(a.selection.getNode());b||(b=a.dom.getParent(a.selection.getNode(),"DIV,P,IMG")),b&&("absolute"==b.style.position.toLowerCase()?(a.dom.setStyles(b,{position:"",left:"",top:"",width:"",height:""}),a.dom.removeClass(b,"mceItemVisualAid"),a.dom.removeClass(b,"mceItemLayer")):(""==b.style.left&&(b.style.left="20px"),""==b.style.top&&(b.style.top="20px"),""==b.style.width&&(b.style.width=b.width?b.width+"px":"100px"),""==b.style.height&&(b.style.height=b.height?b.height+"px":"100px"),b.style.position="absolute",a.dom.setAttrib(b,"data-mce-style",""),a.addVisual(a.getBody())),a.execCommand("mceRepaint"),a.nodeChanged())}}),tinymce.PluginManager.add("layer",tinymce.plugins.Layer)}();
//# sourceMappingURL=editor_plugin.map