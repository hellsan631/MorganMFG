!function(){var a=tinymce.each,b=tinymce.html.Node;tinymce.create("tinymce.plugins.FullPagePlugin",{init:function(a,b){var c=this;c.editor=a,a.addCommand("mceFullPageProperties",function(){a.windowManager.open({file:b+"/fullpage.htm",width:430+parseInt(a.getLang("fullpage.delta_width",0)),height:495+parseInt(a.getLang("fullpage.delta_height",0)),inline:1},{plugin_url:b,data:c._htmlToData()})}),a.addButton("fullpage",{title:"fullpage.desc",cmd:"mceFullPageProperties"}),a.onBeforeSetContent.add(c._setContent,c),a.onGetContent.add(c._getContent,c)},getInfo:function(){return{longname:"Fullpage",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/fullpage",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_htmlToData:function(){function b(a,b){var c=a.attr(b);return c||""}var c,d,e=this._parseHeader(),f={},g=this.editor;return f.fontface=g.getParam("fullpage_default_fontface",""),f.fontsize=g.getParam("fullpage_default_fontsize",""),c=e.firstChild,7==c.type&&(f.xml_pi=!0,d=/encoding="([^"]+)"/.exec(c.value),d&&(f.docencoding=d[1])),c=e.getAll("#doctype")[0],c&&(f.doctype="<!DOCTYPE"+c.value+">"),c=e.getAll("title")[0],c&&c.firstChild&&(f.metatitle=c.firstChild.value),a(e.getAll("meta"),function(a){var b,c=a.attr("name"),d=a.attr("http-equiv");c?f["meta"+c.toLowerCase()]=a.attr("content"):"Content-Type"==d&&(b=/charset\s*=\s*(.*)\s*/gi.exec(a.attr("content")),b&&(f.docencoding=b[1]))}),c=e.getAll("html")[0],c&&(f.langcode=b(c,"lang")||b(c,"xml:lang")),c=e.getAll("link")[0],c&&"stylesheet"==c.attr("rel")&&(f.stylesheet=c.attr("href")),c=e.getAll("body")[0],c&&(f.langdir=b(c,"dir"),f.style=b(c,"style"),f.visited_color=b(c,"vlink"),f.link_color=b(c,"link"),f.active_color=b(c,"alink")),f},_dataToHtml:function(c){function d(a,b,c){a.attr(b,c?c:void 0)}function e(a){g.firstChild?g.insert(a,g.firstChild):g.append(a)}var f,g,h,i,j,k=this.editor.dom;f=this._parseHeader(),g=f.getAll("head")[0],g||(i=f.getAll("html")[0],g=new b("head",1),i.firstChild?i.insert(g,i.firstChild,!0):i.append(g)),i=f.firstChild,c.xml_pi?(j='version="1.0"',c.docencoding&&(j+=' encoding="'+c.docencoding+'"'),7!=i.type&&(i=new b("xml",7),f.insert(i,f.firstChild,!0)),i.value=j):i&&7==i.type&&i.remove(),i=f.getAll("#doctype")[0],c.doctype?(i||(i=new b("#doctype",10),c.xml_pi?f.insert(i,f.firstChild):e(i)),i.value=c.doctype.substring(9,c.doctype.length-1)):i&&i.remove(),i=f.getAll("title")[0],c.metatitle&&(i||(i=new b("title",1),i.append(new b("#text",3)).value=c.metatitle,e(i))),c.docencoding&&(i=null,a(f.getAll("meta"),function(a){"Content-Type"==a.attr("http-equiv")&&(i=a)}),i||(i=new b("meta",1),i.attr("http-equiv","Content-Type"),i.shortEnded=!0,e(i)),i.attr("content","text/html; charset="+c.docencoding)),a("keywords,description,author,copyright,robots".split(","),function(a){var d,g,h=f.getAll("meta"),j=c["meta"+a];for(d=0;d<h.length;d++)if(g=h[d],g.attr("name")==a)return void(j?g.attr("content",j):g.remove());j&&(i=new b("meta",1),i.attr("name",a),i.attr("content",j),i.shortEnded=!0,e(i))}),i=f.getAll("link")[0],i&&"stylesheet"==i.attr("rel")?c.stylesheet?i.attr("href",c.stylesheet):i.remove():c.stylesheet&&(i=new b("link",1),i.attr({rel:"stylesheet",text:"text/css",href:c.stylesheet}),i.shortEnded=!0,e(i)),i=f.getAll("body")[0],i&&(d(i,"dir",c.langdir),d(i,"style",c.style),d(i,"vlink",c.visited_color),d(i,"link",c.link_color),d(i,"alink",c.active_color),k.setAttribs(this.editor.getBody(),{style:c.style,dir:c.dir,vLink:c.visited_color,link:c.link_color,aLink:c.active_color})),i=f.getAll("html")[0],i&&(d(i,"lang",c.langcode),d(i,"xml:lang",c.langcode)),h=new tinymce.html.Serializer({validate:!1,indent:!0,apply_source_formatting:!0,indent_before:"head,html,body,meta,title,script,link,style",indent_after:"head,html,body,meta,title,script,link,style"}).serialize(f),this.head=h.substring(0,h.indexOf("</body>"))},_parseHeader:function(){return new tinymce.html.DomParser({validate:!1,root_name:"#document"}).parse(this.head)},_setContent:function(b,c){function d(a){return a.replace(/<\/?[A-Z]+/g,function(a){return a.toLowerCase()})}var e,f,g,h,i=this,j=c.content,k="",l=i.editor.dom;"raw"==c.format&&i.head||c.source_view&&b.getParam("fullpage_hide_in_source_view")||(j=j.replace(/<(\/?)BODY/gi,"<$1body"),e=j.indexOf("<body"),-1!=e?(e=j.indexOf(">",e),i.head=d(j.substring(0,e+1)),f=j.indexOf("</body",e),-1==f&&(f=j.length),c.content=j.substring(e+1,f),i.foot=d(j.substring(f))):(i.head=this._getDefaultHeader(),i.foot="\n</body>\n</html>"),g=i._parseHeader(),a(g.getAll("style"),function(a){a.firstChild&&(k+=a.firstChild.value)}),h=g.getAll("body")[0],h&&l.setAttribs(i.editor.getBody(),{style:h.attr("style")||"",dir:h.attr("dir")||"",vLink:h.attr("vlink")||"",link:h.attr("link")||"",aLink:h.attr("alink")||""}),l.remove("fullpage_styles"),k&&(l.add(i.editor.getDoc().getElementsByTagName("head")[0],"style",{id:"fullpage_styles"},k),h=l.get("fullpage_styles"),h.styleSheet&&(h.styleSheet.cssText=k)))},_getDefaultHeader:function(){var a,b="",c=this.editor,d="";return c.getParam("fullpage_default_xml_pi")&&(b+='<?xml version="1.0" encoding="'+c.getParam("fullpage_default_encoding","ISO-8859-1")+'" ?>\n'),b+=c.getParam("fullpage_default_doctype",'<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">'),b+="\n<html>\n<head>\n",(a=c.getParam("fullpage_default_title"))&&(b+="<title>"+a+"</title>\n"),(a=c.getParam("fullpage_default_encoding"))&&(b+='<meta http-equiv="Content-Type" content="text/html; charset='+a+'" />\n'),(a=c.getParam("fullpage_default_font_family"))&&(d+="font-family: "+a+";"),(a=c.getParam("fullpage_default_font_size"))&&(d+="font-size: "+a+";"),(a=c.getParam("fullpage_default_text_color"))&&(d+="color: "+a+";"),b+="</head>\n<body"+(d?' style="'+d+'"':"")+">\n"},_getContent:function(a,b){var c=this;b.source_view&&a.getParam("fullpage_hide_in_source_view")||(b.content=tinymce.trim(c.head)+"\n"+tinymce.trim(b.content)+"\n"+tinymce.trim(c.foot))}}),tinymce.PluginManager.add("fullpage",tinymce.plugins.FullPagePlugin)}();
//# sourceMappingURL=editor_plugin_src.map