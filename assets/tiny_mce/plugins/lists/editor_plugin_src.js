!function(){function a(a,b){for(;a&&(8===a.nodeType||3===a.nodeType&&/^[ \t\n\r]*$/.test(a.nodeValue));)a=b(a);return a}function b(b){return a(b,function(a){return a.previousSibling})}function c(b){return a(b,function(a){return a.nextSibling})}function d(a,b,c){return a.dom.getParent(b,function(a){return-1!==tinymce.inArray(c,a)})}function e(a){return a&&("OL"===a.tagName||"UL"===a.tagName)}function f(a,c){var d,f,g;for(d=b(a.lastChild);e(d);)f=d,d=b(f.previousSibling);return f&&(g=c.create("li",{style:"list-style-type: none;"}),c.split(a,f),c.insertAfter(g,f),g.appendChild(f),g.appendChild(f),a=g.previousSibling),a}function g(a,b,c){return a=h(a,b,c),i(a,b,c)}function h(a,c,d){var e=b(a.previousSibling);return e?j(e,a,c?e:!1,d):a}function i(a,b,d){var e=c(a.nextSibling);return e?j(a,e,b?e:!1,d):a}function j(a,b,c,d){return k(a,b,!!c,d)?n(a,b,c):(a&&"LI"===a.tagName&&e(b)&&a.appendChild(b),b)}function k(a,b,c,d){return a&&b?"LI"===a.tagName&&"LI"===b.tagName?"none"===b.style.listStyleType||m(b):e(a)?a.tagName===b.tagName&&(c||a.style.listStyleType===b.style.listStyleType)||l(b):d&&"P"===a.tagName&&"P"===b.tagName:!1}function l(a){var d=c(a.firstChild),f=b(a.lastChild);return d&&f&&e(a)&&d===f&&(e(d)||"none"===d.style.listStyleType||m(d))}function m(a){var d=c(a.firstChild),f=b(a.lastChild);return d&&f&&d===f&&e(d)}function n(a,d,e){var f=b(a.lastChild),g=c(d.firstChild);for("P"===a.tagName&&a.appendChild(a.ownerDocument.createElement("br"));d.firstChild;)a.appendChild(d.firstChild);return e&&(a.style.listStyleType=e.style.listStyleType),d.parentNode.removeChild(d),j(f,g,!1),a}function o(a,b){var c;return b.is(a,"li,ol,ul")||(c=b.getParent(a,"li"),c&&(a=c)),a}var p,q=tinymce.each,r=tinymce.dom.Event;tinymce.create("tinymce.plugins.Lists",{init:function(a){function b(b){return b.keyCode===tinymce.VK.TAB&&!(b.altKey||b.ctrlKey)&&(a.queryCommandState("InsertUnorderedList")||a.queryCommandState("InsertOrderedList"))}function c(){var a=g(),b=a.parentNode.parentNode,c=a.parentNode.lastChild===a;return c&&!d(b)&&h(a)}function d(a){return e(a)?a.parentNode&&"LI"===a.parentNode.tagName:"LI"===a.tagName}function f(){return a.selection.isCollapsed()&&h(g())}function g(){var b=a.selection.getStart();return"BR"!=b.tagName&&""!=b.tagName||"LI"!=b.parentNode.tagName?b:b.parentNode}function h(a){var b=a.childNodes.length;return"LI"===a.tagName?0==b?!0:1==b&&(""==a.firstChild.tagName||"BR"==a.firstChild.tagName||i(a)):!1}function i(a){var b=tinymce.grep(a.parentNode.childNodes,function(a){return"LI"==a.tagName}),c=a==b[b.length-1],d=a.firstChild;return tinymce.isIE9&&c&&(d.nodeValue==String.fromCharCode(160)||d.nodeValue==String.fromCharCode(32))}function j(a){return a.keyCode===tinymce.VK.ENTER}function k(a){return j(a)&&!a.shiftKey}function l(a){return b(a)?y:k(a)&&c()?B:k(a)&&f()?z:B}function m(a,b){(C==y||C==z||tinymce.isGecko&&C==A)&&r.cancel(b)}function n(){var b=a.selection.getRng(!0),c=b.startContainer;if(3==c.nodeType){var d=c.nodeValue;return tinymce.isIE9&&d.length>1&&32==d.charCodeAt(d.length-1)?b.endOffset==d.length-1:b.endOffset==d.length}return 1==c.nodeType?b.endOffset==c.childNodes.length:!1}function o(){var b=a.selection.getNode(),c="h1,h2,h3,h4,h5,h6,p,div",d=a.dom.is(b,c)&&"LI"===b.parentNode.tagName&&b.parentNode.lastChild===b;return a.selection.isCollapsed()&&d&&n()}function p(a,b){if(k(b)&&o()){var c=a.selection.getNode(),d=a.dom.create("li"),e=a.dom.getParent(c,"li");a.dom.insertAfter(d,e),tinymce.isIE6||tinymce.isIE7||tinyMCE.isIE8?a.selection.setCursorLocation(d,1):a.selection.setCursorLocation(d,0),b.preventDefault()}}function q(a,b){function c(a){var b=a.firstChild,c=null;do{if(!b)break;"LI"===b.tagName&&(c=b)}while(b=b.nextSibling);return c}function d(a,b){for(;a.childNodes.length>0;)b.appendChild(a.childNodes[0])}var e;if(tinymce.isGecko){var f=a.selection.getStart();if(b.keyCode==tinymce.VK.BACKSPACE&&"IMG"===f.tagName&&(e=f.parentNode.previousSibling)){var g;if("UL"===e.tagName||"OL"===e.tagName)g=e;else{if(!e.previousSibling||"UL"!==e.previousSibling.tagName&&"OL"!==e.previousSibling.tagName)return;g=e.previousSibling}var h=c(g),i=a.dom.createRng();i.setStart(h,1),i.setEnd(h,1),a.selection.setRng(i),a.selection.collapse(!0);var j=a.selection.getBookmark(),k=f.parentNode.cloneNode(!0);"P"===k.tagName||"DIV"===k.tagName?d(k,h):h.appendChild(k),f.parentNode.parentNode.removeChild(f.parentNode),a.selection.moveToBookmark(j)}}}function s(b){var c=a.dom.getParent(b,"ol,ul");if(null!=c){var d=c.lastChild;a.selection.setCursorLocation(d,0)}}function t(b,c){var d=a.getDoc().createTextNode("");b.insertBefore(d,c),a.selection.setCursorLocation(d,0),a.execCommand("mceRepaint")}function u(a,b){if(j(b)){var c=g();if(c){var d=c.parentNode,e=d&&d.parentNode;e&&"LI"==e.nodeName&&e.firstChild==d&&c==d.firstChild&&t(e,d)}}}function v(a,b){if(j(b)){var c=g();if(1===a.dom.select("ul li",c).length){var d=c.firstChild;t(c,d)}}}function w(a,b){function c(b){for(var c=[],d=new tinymce.dom.TreeWalker(b.firstChild,b),e=d.current();e;e=d.next())a.dom.is(e,"ol,ul,li")&&c.push(e);return c}if(b.keyCode==tinymce.VK.BACKSPACE){var d=g();if(d){var e=a.dom.getParent(d,"ol,ul"),f=a.selection.getRng();if(e&&e.firstChild===d&&0==f.startOffset){var h=c(d);return h.unshift(d),a.execCommand("Outdent",!1,h),a.undoManager.add(),r.cancel(b)}}}}function x(a,b){var c=g();if(b.keyCode===tinymce.VK.BACKSPACE&&a.dom.is(c,"li")&&c.parentNode.firstChild!==c&&1===a.dom.select("ul,ol",c).length){var d=c.previousSibling;a.dom.remove(a.dom.select("br",c)),a.dom.remove(c,!0);var e=tinymce.grep(d.childNodes,function(a){return 3===a.nodeType});if(1===e.length){var f=e[0];a.selection.setCursorLocation(f,f.length)}return a.undoManager.add(),r.cancel(b)}}var y="TABBING",z="EMPTY",A="ESCAPE",B="UNKNOWN",C=B;this.ed=a,a.addCommand("Indent",this.indent,this),a.addCommand("Outdent",this.outdent,this),a.addCommand("InsertUnorderedList",function(){this.applyList("UL","OL")},this),a.addCommand("InsertOrderedList",function(){this.applyList("OL","UL")},this),a.onInit.add(function(){a.editorCommands.addCommands({outdent:function(){function b(b){return b=d.getParent(b,d.isBlock),b&&parseInt(a.dom.getStyle(b,"margin-left")||0,10)+parseInt(a.dom.getStyle(b,"padding-left")||0,10)>0}var c=a.selection,d=a.dom;return b(c.getStart())||b(c.getEnd())||a.queryCommandState("InsertOrderedList")||a.queryCommandState("InsertUnorderedList")}},"state")}),a.onKeyUp.add(function(a,b){if(C==y)return a.execCommand(b.shiftKey?"Outdent":"Indent",!0,null),C=B,r.cancel(b);if(C==z){var c=g(),d=a.settings.list_outdent_on_enter===!0||b.shiftKey;return a.execCommand(d?"Outdent":"Indent",!0,null),tinymce.isIE&&s(c),r.cancel(b)}if(C==A)if(tinymce.isIE6||tinymce.isIE7||tinymce.isIE8){var e=a.getDoc().createTextNode("");a.selection.getNode().appendChild(e)}else if(tinymce.isIE9||tinymce.isGecko)return a.execCommand("Outdent"),r.cancel(b)}),a.onKeyDown.add(function(a,b){C=l(b)}),a.onKeyDown.add(m),a.onKeyDown.add(q),a.onKeyDown.add(p),tinymce.isGecko&&a.onKeyUp.add(u),tinymce.isIE8&&a.onKeyUp.add(v),(tinymce.isGecko||tinymce.isWebKit)&&a.onKeyDown.add(w),tinymce.isWebKit&&a.onKeyDown.add(x)},applyList:function(a,b){function c(a){a&&"BR"===a.tagName&&s.remove(a)}function d(b){function d(a){(a.style.marginLeft||a.style.paddingLeft)&&n.adjustPaddingFunction(!1)(a)}var f,i=s.create(a);if("LI"===b.tagName);else{if("P"===b.tagName||"DIV"===b.tagName||"BODY"===b.tagName)return h(b,function(a,g){e(a,g,"BODY"===b.tagName?null:a.parentNode),f=a.parentNode,d(f),c(g)}),void(f&&("LI"===f.tagName&&("P"===b.tagName||x.length>1)&&s.split(f.parentNode.parentNode,f.parentNode),g(f.parentNode,!0)));f=s.create("li"),s.insertAfter(f,b),f.appendChild(b),d(b),b=f}s.insertAfter(i,b),i.appendChild(b),g(i,!0),t.push(b)}function e(a,b,c){for(var e,f,g=a;!s.isBlock(a.parentNode)&&a.parentNode!==s.getRoot();)a=s.split(a.parentNode,a.previousSibling),a=a.nextSibling,g=a;if(c){for(e=c.cloneNode(!0),a.parentNode.insertBefore(e,a);e.firstChild;)s.remove(e.firstChild);e=s.rename(e,"li")}else e=s.create("li"),a.parentNode.insertBefore(e,a);for(;g&&g!=b;)f=g.nextSibling,e.appendChild(g),g=f;0===e.childNodes.length&&(e.innerHTML='<br _mce_bogus="1" />'),d(e)}function h(a,b){function c(a,b){var c,d=s.createRng();return p.keep=!0,r.selection.moveToBookmark(p),p.keep=!1,c=r.selection.getRng(!0),b||(b=a.parentNode.lastChild),d.setStartBefore(a),d.setEndAfter(b),!(d.compareBoundaryPoints(g,c)>0||d.compareBoundaryPoints(h,c)<=0)}function d(a){return a.nextSibling?a.nextSibling:s.isBlock(a.parentNode)||a.parentNode===s.getRoot()?void 0:d(a.parentNode)}var e,f,g=3,h=1,i="br,ul,ol,p,div,h1,h2,h3,h4,h5,h6,table,blockquote,address,pre,form,center,dl";e=a.firstChild;var j=!1;q(s.select(i,a),function(a){return a.hasAttribute&&a.hasAttribute("_mce_bogus")?!0:void(c(e,a)&&(s.addClass(a,"_mce_tagged_br"),e=d(a)))}),j=e&&c(e,void 0),e=a.firstChild,q(s.select(i,a),function(a){var c=d(a);return a.hasAttribute&&a.hasAttribute("_mce_bogus")?!0:(s.hasClass(a,"_mce_tagged_br")?(b(e,a,f),f=null):f=a,void(e=c))}),j&&b(e,void 0,f)}function j(a){h(a,function(a,b,d){e(a,b),c(b),c(d)})}function k(a){-1===tinymce.inArray(t,a)&&(a.parentNode.tagName===b&&(s.split(a.parentNode,a),d(a),i(a.parentNode,!1)),t.push(a))}function l(a){var b,c,d,e;if(-1===tinymce.inArray(t,a)){for(a=f(a,s);s.is(a.parentNode,"ol,ul,li");)s.split(a.parentNode,a);if(t.push(a),a=s.rename(a,"p"),d=g(a,!1,r.settings.force_br_newlines),d===a)for(b=a.firstChild;b;)s.isBlock(b)?(b=s.split(b.parentNode,b),e=!0,c=b.nextSibling&&b.nextSibling.firstChild):(c=b.nextSibling,e&&"BR"===b.tagName&&s.remove(b),e=!1),b=c}}var m,n=this,r=n.ed,s=r.dom,t=[],u=!1,v=!1,w=!1,x=r.selection.getSelectedBlocks();q(x,function(c){c=o(c,s),c.tagName===b||"LI"===c.tagName&&c.parentNode.tagName===b?v=!0:c.tagName===a||"LI"===c.tagName&&c.parentNode.tagName===a?u=!0:w=!0}),m=w&&!u||v||0===x.length?{LI:k,H1:d,H2:d,H3:d,H4:d,H5:d,H6:d,P:d,BODY:d,DIV:x.length>1?d:j,defaultAction:j,elements:this.selectedBlocks()}:{defaultAction:l,elements:this.selectedBlocks(),processEvenIfEmpty:!0},this.process(m)},indent:function(){function a(a){var b=h.create("li",{style:"list-style-type: none;"});return h.insertAfter(b,a),b}function b(b){var c,d=a(b),e=h.getParent(b,"ol,ul"),f=e.tagName,g=h.getStyle(e,"list-style-type"),i={};return""!==g&&(i.style="list-style-type: "+g+";"),c=h.create(f,i),d.appendChild(c),c}function c(a){if(!d(e,a,i)){a=f(a,h);var c=b(a);c.appendChild(a),g(c.parentNode,!1),g(c,!1),i.push(a)}}var e=this.ed,h=e.dom,i=[];this.process({LI:c,defaultAction:this.adjustPaddingFunction(!0),elements:this.selectedBlocks()})},outdent:function(a,b){function c(a){var b,c,g;if(!d(h,a,j)){if(""!==i.getStyle(a,"margin-left")||""!==i.getStyle(a,"padding-left"))return e.adjustPaddingFunction(!1)(a);if(g=i.getStyle(a,"text-align",!0),"center"===g||"right"===g)return void i.setStyle(a,"text-align","left");a=f(a,i),b=a.parentNode,c=a.parentNode.parentNode,"P"===c.tagName?i.split(c,a.parentNode):(i.split(b,a),"LI"===c.tagName?i.split(c,a):i.is(c,"ol,ul")||i.rename(a,"p")),j.push(a)}}var e=this,h=e.ed,i=h.dom,j=[],k=b&&tinymce.is(b,"array")?b:this.selectedBlocks();this.process({LI:c,defaultAction:this.adjustPaddingFunction(!1),elements:k}),q(j,g)},process:function(a){function b(a){var b=tinymce.grep(a.childNodes,function(a){return!("BR"===a.nodeName||"SPAN"===a.nodeName&&"bookmark"==k.getAttrib(a,"data-mce-type")||3==a.nodeType&&(a.nodeValue==String.fromCharCode(160)||""==a.nodeValue))});return 0===b.length}function c(c){if(k.removeClass(c,"_mce_act_on"),c&&1===c.nodeType&&!(!a.processEvenIfEmpty&&g.length>1&&b(c))){c=o(c,k);var d=a[c.tagName];d||(d=a.defaultAction),d(c)}}function d(a){i.splitSafeEach(a.childNodes,c,!0)}function e(a,b){return b>=0&&a.hasChildNodes()&&b<a.childNodes.length&&"BR"===a.childNodes[b].tagName}function f(){var a=j.getNode(),b=k.getParent(a,"td");return null!==b}var g,h,i=this,j=i.ed.selection,k=i.ed.dom;if(g=a.elements,h=j.getRng(!0),h.collapsed||(e(h.endContainer,h.endOffset-1)&&(h.setEnd(h.endContainer,h.endOffset-1),j.setRng(h)),e(h.startContainer,h.startOffset)&&(h.setStart(h.startContainer,h.startOffset+1),j.setRng(h))),tinymce.isIE8){var l=i.ed.selection.getNode();if("LI"===l.tagName&&l.parentNode.lastChild!==l){var m=i.ed.getDoc().createTextNode("");l.appendChild(m)}}p=j.getBookmark(),a.OL=a.UL=d,i.splitSafeEach(g,c),j.moveToBookmark(p),p=null,f()||i.ed.execCommand("mceRepaint")},splitSafeEach:function(a,b,c){c||tinymce.isGecko&&(/Firefox\/[12]\.[0-9]/.test(navigator.userAgent)||/Firefox\/3\.[0-4]/.test(navigator.userAgent))?this.classBasedEach(a,b):q(a,b)},classBasedEach:function(a,b){var c,d,e=this.ed.dom;for(q(a,function(a){e.addClass(a,"_mce_act_on")}),c=e.select("._mce_act_on");c.length>0;)d=c.shift(),e.removeClass(d,"_mce_act_on"),b(d),c=e.select("._mce_act_on")},adjustPaddingFunction:function(a){var b,c,d=this.ed;return b=d.settings.indentation,c=/[a-z%]+/i.exec(b),b=parseInt(b,10),function(e){var f,g;f=parseInt(d.dom.getStyle(e,"margin-left")||0,10)+parseInt(d.dom.getStyle(e,"padding-left")||0,10),g=a?f+b:f-b,d.dom.setStyle(e,"padding-left",""),d.dom.setStyle(e,"margin-left",g>0?g+c:"")}},selectedBlocks:function(){var a=this.ed,b=a.selection.getSelectedBlocks();return 0==b.length?[a.dom.getRoot()]:b},getInfo:function(){return{longname:"Lists",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/lists",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("lists",tinymce.plugins.Lists)}();