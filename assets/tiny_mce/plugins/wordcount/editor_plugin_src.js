!function(){tinymce.create("tinymce.plugins.WordCount",{block:0,id:null,countre:null,cleanre:null,init:function(a){function b(a){return a!==e&&(a===f.ENTER||e===f.SPACEBAR||c(e))}function c(a){return a===f.DELETE||a===f.BACKSPACE}var d=this,e=0,f=tinymce.VK;d.countre=a.getParam("wordcount_countregex",/[\w\u2019\'-]+/g),d.cleanre=a.getParam("wordcount_cleanregex",/[0-9.(),;:!?%#$?\'\"_+=\\\/-]*/g),d.update_rate=a.getParam("wordcount_update_rate",2e3),d.update_on_delete=a.getParam("wordcount_update_on_delete",!1),d.id=a.id+"-word-count",a.onPostRender.add(function(a){var b,c;c=a.getParam("wordcount_target_id"),c?tinymce.DOM.add(c,"span",{},'<span id="'+d.id+'">0</span>'):(b=tinymce.DOM.get(a.id+"_path_row"),b&&tinymce.DOM.add(b.parentNode,"div",{style:"float: right"},a.getLang("wordcount.words","Words: ")+'<span id="'+d.id+'">0</span>'))}),a.onInit.add(function(a){a.selection.onSetContent.add(function(){d._count(a)}),d._count(a)}),a.onSetContent.add(function(a){d._count(a)}),a.onKeyUp.add(function(a,f){(b(f.keyCode)||d.update_on_delete&&c(f.keyCode))&&d._count(a),e=f.keyCode})},_getCount:function(a){var b=0,c=a.getContent({format:"raw"});if(c){c=c.replace(/\.\.\./g," "),c=c.replace(/<.[^<>]*?>/g," ").replace(/&nbsp;|&#160;/gi," "),c=c.replace(/(\w+)(&.+?;)+(\w+)/,"$1$3").replace(/&.+?;/g," "),c=c.replace(this.cleanre,"");var d=c.match(this.countre);d&&(b=d.length)}return b},_count:function(a){var b=this;b.block||(b.block=1,setTimeout(function(){if(!a.destroyed){var c=b._getCount(a);tinymce.DOM.setHTML(b.id,c.toString()),setTimeout(function(){b.block=0},b.update_rate)}},1))},getInfo:function(){return{longname:"Word Count plugin",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/wordcount",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("wordcount",tinymce.plugins.WordCount)}();