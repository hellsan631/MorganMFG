!function(){function a(a){function c(a){var b;if(1===a.nodeType){if(b=a.getAttribute(d),b&&"inherit"!==b)return b;if(b=a.contentEditable,"inherit"!==b)return b}return null}function f(a){for(var b;a;){if(b=c(a))return"false"===b?a:null;a=a.parentNode}}function g(a){for(;a;){if(a.id===p)return a;a=a.parentNode}}function h(a){var c;if(a)for(c=new b(a,a),a=c.current();a;a=c.next())if(3===a.nodeType)return a}function i(b,d){var e,f;return"false"===c(b)&&n.isBlock(b)?void o.select(b):(f=n.createRng(),"true"===c(b)&&(b.firstChild||b.appendChild(a.getDoc().createTextNode("Â ")),b=b.firstChild,d=!0),e=n.create("span",{id:p,"data-mce-bogus":!0},m),d?b.parentNode.insertBefore(e,b):n.insertAfter(e,b),f.setStart(e.firstChild,1),f.collapse(!0),o.setRng(f),e)}function j(a){var b,c,d;if(a)rng=o.getRng(!0),rng.setStartBefore(a),rng.setEndBefore(a),b=h(a),b&&b.nodeValue.charAt(0)==m&&(b=b.deleteData(0,1)),n.remove(a,!0),o.setRng(rng);else for(c=g(o.getStart());(a=n.get(p))&&a!==d;)c!==a&&(b=h(a),b&&b.nodeValue.charAt(0)==m&&(b=b.deleteData(0,1)),n.remove(a,!0)),d=a}function k(){function a(a,d){var e,f,g,i,j;if(e=h.startContainer,f=h.startOffset,3==e.nodeType){if(j=e.nodeValue.length,f>0&&j>f||(d?f==j:0==f))return}else{if(!(f<e.childNodes.length))return d?null:a;var k=!d&&f>0?f-1:f;e=e.childNodes[k],e.hasChildNodes()&&(e=e.firstChild)}for(g=new b(e,a);i=g[d?"prev":"next"]();){if(3===i.nodeType&&i.nodeValue.length>0)return;if("true"===c(i))return i}return a}var d,e,g,h,k;j(),g=o.isCollapsed(),d=f(o.getStart()),e=f(o.getEnd()),(d||e)&&(h=o.getRng(!0),g?(d=d||e,o.getStart(),(k=a(d,!0))?i(k,!0):(k=a(d,!1))?i(k,!1):o.select(d)):(h=o.getRng(!0),d&&h.setStartBefore(d),e&&h.setEndAfter(e),o.setRng(h)))}function l(a,d){function h(a,b){for(;a=a[b?"previousSibling":"nextSibling"];)if(3!==a.nodeType||a.nodeValue.length>0)return a}function i(a,b){o.select(a),o.collapse(b)}function l(b){function d(a){for(var b=i;b;){if(b===a)return;b=b.parentNode}n.remove(a),k()}function e(){var e,g,h=a.schema.getNonEmptyElements();for(g=new tinymce.dom.TreeWalker(i,a.getBody());(e=b?g.prev():g.next())&&!h[e.nodeName.toLowerCase()]&&!(3===e.nodeType&&tinymce.trim(e.nodeValue).length>0);)if("false"===c(e))return d(e),!0;return f(e)?!0:!1}var h,i,j,l;if(o.isCollapsed()){if(h=o.getRng(!0),i=h.startContainer,j=h.startOffset,i=g(i)||i,l=f(i))return d(l),!1;if(3==i.nodeType&&(b?j>0:j<i.nodeValue.length))return!0;if(1==i.nodeType&&(i=i.childNodes[j]||i),e())return!1}return!0}var m,p,q,r,s=d.keyCode;if(q=o.getStart(),r=o.getEnd(),m=f(q)||f(r),m&&(112>s||s>124)&&s!=e.DELETE&&s!=e.BACKSPACE){if((tinymce.isMac?d.metaKey:d.ctrlKey)&&(67==s||88==s||86==s))return;if(d.preventDefault(),s==e.LEFT||s==e.RIGHT){var t=s==e.LEFT;if(a.dom.isBlock(m)){var u=t?m.previousSibling:m.nextSibling,v=new b(u,u),w=t?v.prev():v.next();i(w,!t)}else i(m,t)}}else if(s==e.LEFT||s==e.RIGHT||s==e.BACKSPACE||s==e.DELETE){if(p=g(q)){if(s==e.LEFT||s==e.BACKSPACE)if(m=h(p,!0),m&&"false"===c(m)){if(d.preventDefault(),s!=e.LEFT)return void n.remove(m);i(m,!0)}else j(p);if(s==e.RIGHT||s==e.DELETE)if(m=h(p),m&&"false"===c(m)){if(d.preventDefault(),s!=e.RIGHT)return void n.remove(m);i(m,!1)}else j(p)}if((s==e.BACKSPACE||s==e.DELETE)&&!l(s==e.BACKSPACE))return d.preventDefault(),!1}}var m,n=a.dom,o=a.selection,p="mce_noneditablecaret",m="";a.onMouseDown.addToTop(function(a,b){var d=a.selection.getNode();"false"===c(d)&&d==b.target&&k()}),a.onMouseUp.addToTop(k),a.onKeyDown.addToTop(l),a.onKeyUp.addToTop(k)}var b=tinymce.dom.TreeWalker,c="contenteditable",d="data-mce-"+c,e=tinymce.VK;tinymce.create("tinymce.plugins.NonEditablePlugin",{init:function(b){function e(a,b){var c=h.length,d=b.content,e=tinymce.trim(g);if("raw"!=b.format){for(;c--;)d=d.replace(h[c],function(b){var c=arguments,f=c[c.length-2];return f>0&&'"'==d.charAt(f-1)?b:'<span class="'+e+'" data-mce-content="'+a.dom.encode(c[0])+'">'+a.dom.encode("string"==typeof c[1]?c[1]:c[0])+"</span>"});b.content=d}}var f,g,h;f=" "+tinymce.trim(b.getParam("noneditable_editable_class","mceEditable"))+" ",g=" "+tinymce.trim(b.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",h=b.getParam("noneditable_regexp"),h&&!h.length&&(h=[h]),b.onPreInit.add(function(){a(b),h&&(b.selection.onBeforeSetContent.add(e),b.onBeforeSetContent.add(e)),b.parser.addAttributeFilter("class",function(a){for(var b,c,e=a.length;e--;)c=a[e],b=" "+c.attr("class")+" ",-1!==b.indexOf(f)?c.attr(d,"true"):-1!==b.indexOf(g)&&c.attr(d,"false")}),b.serializer.addAttributeFilter(d,function(a){for(var b,e=a.length;e--;)b=a[e],h&&b.attr("data-mce-content")?(b.name="#text",b.type=3,b.raw=!0,b.value=b.attr("data-mce-content")):(b.attr(c,null),b.attr(d,null))}),b.parser.addAttributeFilter(c,function(a){for(var b,e=a.length;e--;)b=a[e],b.attr(d,b.attr(c)),b.attr(c,null)})})},getInfo:function(){return{longname:"Non editable elements",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("noneditable",tinymce.plugins.NonEditablePlugin)}();