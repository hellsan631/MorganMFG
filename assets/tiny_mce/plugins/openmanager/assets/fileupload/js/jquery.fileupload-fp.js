!function(a){"use strict";"function"==typeof define&&define.amd?define(["jquery","load-image","canvas-to-blob","./jquery.fileupload"],a):a(window.jQuery,window.loadImage)}(function(a,b){"use strict";a.widget("blueimpFP.fileupload",a.blueimp.fileupload,{options:{process:[],add:function(b,c){a(this).fileupload("process",c).done(function(){c.submit()})}},processActions:{load:function(c,d){var e=this,f=c.files[c.index],g=a.Deferred();return window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype.toBlob&&("number"!==a.type(d.maxFileSize)||f.size<d.maxFileSize)&&(!d.fileTypes||d.fileTypes.test(f.type))?b(f,function(a){c.canvas=a,g.resolveWith(e,[c])},{canvas:!0}):g.rejectWith(e,[c]),g.promise()},resize:function(a,c){if(a.canvas){var d=b.scale(a.canvas,c);(d.width!==a.canvas.width||d.height!==a.canvas.height)&&(a.canvas=d,a.processed=!0)}return a},save:function(b){if(!b.canvas||!b.processed)return b;var c=this,d=b.files[b.index],e=d.name,f=a.Deferred(),g=function(a){a.name||(d.type===a.type?a.name=d.name:d.name&&(a.name=d.name.replace(/\..+$/,"."+a.type.substr(6)))),b.files[b.index]=a,f.resolveWith(c,[b])};return b.canvas.mozGetAsFile?g(b.canvas.mozGetAsFile(/^image\/(jpeg|png)$/.test(d.type)&&e||(e&&e.replace(/\..+$/,"")||"blob")+".png",d.type)):b.canvas.toBlob(g,d.type),f.promise()}},_processFile:function(b,c,d){var e=this,f=a.Deferred().resolveWith(e,[{files:b,index:c}]),g=f.promise();return e._processing+=1,a.each(d.process,function(a,b){g=g.pipe(function(a){return e.processActions[b.action].call(this,a,b)})}),g.always(function(){e._processing-=1,0===e._processing&&e.element.removeClass("fileupload-processing")}),1===e._processing&&e.element.addClass("fileupload-processing"),g},process:function(b){var c=this,d=a.extend({},this.options,b);return d.process&&d.process.length&&this._isXHRUpload(d)&&a.each(b.files,function(e){c._processingQueue=c._processingQueue.pipe(function(){var f=a.Deferred();return c._processFile(b.files,e,d).always(function(){f.resolveWith(c)}),f.promise()})}),this._processingQueue},_create:function(){a.blueimp.fileupload.prototype._create.call(this),this._processing=0,this._processingQueue=a.Deferred().resolveWith(this).promise()}})});