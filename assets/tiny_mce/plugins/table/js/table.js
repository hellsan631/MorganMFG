function insertTable(){var a,b,c,d,e,f,g,h,i,j,k,l,m=document.forms[0],n=tinyMCEPopup.editor,o=n.dom,p=2,q=2,r=0,s=-1,t=-1,u="";if(tinyMCEPopup.restoreSelection(),!AutoValidator.validate(m))return tinyMCEPopup.alert(AutoValidator.getErrorMessages(m).join(". ")+"."),!1;if(i=o.getParent(n.selection.getNode(),"table"),p=m.elements.cols.value,q=m.elements.rows.value,r=""!=m.elements.border.value?m.elements.border.value:0,s=""!=m.elements.cellpadding.value?m.elements.cellpadding.value:"",t=""!=m.elements.cellspacing.value?m.elements.cellspacing.value:"",a=getSelectValue(m,"align"),f=getSelectValue(m,"tframe"),g=getSelectValue(m,"rules"),b=m.elements.width.value,c=m.elements.height.value,bordercolor=m.elements.bordercolor.value,bgcolor=m.elements.bgcolor.value,d=getSelectValue(m,"class"),id=m.elements.id.value,summary=m.elements.summary.value,style=m.elements.style.value,dir=m.elements.dir.value,lang=m.elements.lang.value,background=m.elements.backgroundimage.value,e=m.elements.caption.checked,j=tinyMCEPopup.getParam("table_cell_limit",!1),k=tinyMCEPopup.getParam("table_row_limit",!1),l=tinyMCEPopup.getParam("table_col_limit",!1),l&&p>l)return tinyMCEPopup.alert(n.getLang("table_dlg.col_limit").replace(/\{\$cols\}/g,l)),!1;if(k&&q>k)return tinyMCEPopup.alert(n.getLang("table_dlg.row_limit").replace(/\{\$rows\}/g,k)),!1;if(j&&p*q>j)return tinyMCEPopup.alert(n.getLang("table_dlg.cell_limit").replace(/\{\$cells\}/g,j)),!1;if("update"==action)return o.setAttrib(i,"cellPadding",s,!0),o.setAttrib(i,"cellSpacing",t,!0),isCssSize(r)?o.setAttrib(i,"border",""):o.setAttrib(i,"border",r),""==r&&(o.setStyle(i,"border-width",""),o.setStyle(i,"border",""),o.setAttrib(i,"border","")),o.setAttrib(i,"align",a),o.setAttrib(i,"frame",f),o.setAttrib(i,"rules",g),o.setAttrib(i,"class",d),o.setAttrib(i,"style",style),o.setAttrib(i,"id",id),o.setAttrib(i,"summary",summary),o.setAttrib(i,"dir",dir),o.setAttrib(i,"lang",lang),h=n.dom.select("caption",i)[0],h&&!e&&h.parentNode.removeChild(h),!h&&e&&(h=i.ownerDocument.createElement("caption"),tinymce.isIE||(h.innerHTML='<br data-mce-bogus="1"/>'),i.insertBefore(h,i.firstChild)),b&&n.settings.inline_styles?(o.setStyle(i,"width",b),o.setAttrib(i,"width","")):(o.setAttrib(i,"width",b,!0),o.setStyle(i,"width","")),o.setAttrib(i,"borderColor",""),o.setAttrib(i,"bgColor",""),o.setAttrib(i,"background",""),c&&n.settings.inline_styles?(o.setStyle(i,"height",c),o.setAttrib(i,"height","")):(o.setAttrib(i,"height",c,!0),o.setStyle(i,"height","")),i.style.backgroundImage=""!=background?"url('"+background+"')":"",""!=bordercolor?(i.style.borderColor=bordercolor,i.style.borderStyle=""==i.style.borderStyle?"solid":i.style.borderStyle,i.style.borderWidth=cssSize(r)):i.style.borderColor="",i.style.backgroundColor=bgcolor,i.style.height=getCSSSize(c),n.addVisual(),n.nodeChanged(),n.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),(m.width.value!=orgTableWidth||m.height.value!=orgTableHeight)&&n.execCommand("mceRepaint"),tinyMCEPopup.close(),!0;u+="<table",u+=makeAttrib("id",id),isCssSize(r)||(u+=makeAttrib("border",r)),u+=makeAttrib("cellpadding",s),u+=makeAttrib("cellspacing",t),u+=makeAttrib("data-mce-new","1"),b&&n.settings.inline_styles?(style&&(style+="; "),/^[0-9\.]+$/.test(b)&&(b+="px"),style+="width: "+b):u+=makeAttrib("width",b),u+=makeAttrib("align",a),u+=makeAttrib("frame",f),u+=makeAttrib("rules",g),u+=makeAttrib("class",d),u+=makeAttrib("style",style),u+=makeAttrib("summary",summary),u+=makeAttrib("dir",dir),u+=makeAttrib("lang",lang),u+=">",e&&(u+=tinymce.isIE?"<caption></caption>":'<caption><br data-mce-bogus="1"/></caption>');for(var v=0;q>v;v++){u+="<tr>";for(var w=0;p>w;w++)u+=tinymce.isIE?"<td></td>":'<td><br data-mce-bogus="1"/></td>';u+="</tr>"}if(u+="</table>",n.settings.fix_table_elements){var x="";n.focus(),n.selection.setContent('<br class="_mce_marker" />'),tinymce.each("h1,h2,h3,h4,h5,h6,p".split(","),function(a){x&&(x+=","),x+=a+" ._mce_marker"}),tinymce.each(n.dom.select(x),function(a){n.dom.split(n.dom.getParent(a,"h1,h2,h3,h4,h5,h6,p"),a)}),o.setOuterHTML(o.select("br._mce_marker")[0],u)}else n.execCommand("mceInsertContent",!1,u);tinymce.each(o.select("table[data-mce-new]"),function(a){var b=o.select("td,th",a);tinymce.isIE&&null==a.nextSibling&&(n.settings.forced_root_block?o.insertAfter(o.create(n.settings.forced_root_block),a):o.insertAfter(o.create("br",{"data-mce-bogus":"1"}),a));try{n.selection.setCursorLocation(b[0],0)}catch(c){}o.setAttrib(a,"data-mce-new","")}),n.addVisual(),n.execCommand("mceEndUndoLevel",!1,{},{skip_undo:!0}),tinyMCEPopup.close()}function makeAttrib(a,b){var c=document.forms[0],d=c.elements[a];return("undefined"==typeof b||null==b)&&(b="",d&&(b=d.value)),""==b?"":(b=b.replace(/&/g,"&amp;"),b=b.replace(/\"/g,"&quot;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;")," "+a+'="'+b+'"')}function init(){tinyMCEPopup.resizeToInnerSize(),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("backgroundimagebrowsercontainer").innerHTML=getBrowserHTML("backgroundimagebrowser","backgroundimage","image","table"),document.getElementById("bordercolor_pickcontainer").innerHTML=getColorPickerHTML("bordercolor_pick","bordercolor"),document.getElementById("bgcolor_pickcontainer").innerHTML=getColorPickerHTML("bgcolor_pick","bgcolor");var a=2,b=2,c=tinyMCEPopup.getParam("table_default_border","0"),d=tinyMCEPopup.getParam("table_default_cellpadding",""),e=tinyMCEPopup.getParam("table_default_cellspacing",""),f="",g="",h="",i="",j="",k="",l="",m="",n="",o="",p="",q="",j="",i="",r="",s="",t=tinyMCEPopup.editor,u=t.dom,v=document.forms[0],w=u.getParent(t.selection.getNode(),"table");if(tinymce.each("summary id rules dir style frame".split(" "),function(a){var b=tinyMCEPopup.dom.getParent(a,"tr")||tinyMCEPopup.dom.getParent("t"+a,"tr");b&&!tinyMCEPopup.editor.schema.isValid("table",a)&&(b.style.display="none")}),action=tinyMCEPopup.getWindowArg("action"),action||(action=w?"update":"insert"),w&&"insert"!=action){for(var x=w.rows,a=0,y=0;y<x.length;y++)x[y].cells.length>a&&(a=x[y].cells.length);a=a,b=x.length,st=u.parseStyle(u.getAttrib(w,"style")),c=trimSize(getStyle(w,"border","borderWidth")),d=u.getAttrib(w,"cellpadding",""),e=u.getAttrib(w,"cellspacing",""),g=trimSize(getStyle(w,"width","width")),h=trimSize(getStyle(w,"height","height")),i=convertRGBToHex(getStyle(w,"bordercolor","borderLeftColor")),j=convertRGBToHex(getStyle(w,"bgcolor","backgroundColor")),f=u.getAttrib(w,"align",f),s=u.getAttrib(w,"frame"),r=u.getAttrib(w,"rules"),k=tinymce.trim(u.getAttrib(w,"class").replace(/mceItem.+/g,"")),l=u.getAttrib(w,"id"),m=u.getAttrib(w,"summary"),n=u.serializeStyle(st),o=u.getAttrib(w,"dir"),p=u.getAttrib(w,"lang"),q=getStyle(w,"background","backgroundImage").replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"),v.caption.checked=w.getElementsByTagName("caption").length>0,orgTableWidth=g,orgTableHeight=h,action="update",v.insert.value=t.getLang("update")}addClassesToList("class","table_styles"),TinyMCE_EditableSelects.init(),selectByValue(v,"align",f),selectByValue(v,"tframe",s),selectByValue(v,"rules",r),selectByValue(v,"class",k,!0,!0),v.cols.value=a,v.rows.value=b,v.border.value=c,v.cellpadding.value=d,v.cellspacing.value=e,v.width.value=g,v.height.value=h,v.bordercolor.value=i,v.bgcolor.value=j,v.id.value=l,v.summary.value=m,v.style.value=n,v.dir.value=o,v.lang.value=p,v.backgroundimage.value=q,updateColor("bordercolor_pick","bordercolor"),updateColor("bgcolor_pick","bgcolor"),isVisible("backgroundimagebrowser")&&(document.getElementById("backgroundimage").style.width="180px"),"update"==action&&(v.cols.disabled=!0,v.rows.disabled=!0)}function changedSize(){var a=document.forms[0],b=dom.parseStyle(a.style.value),c=a.height.value;b.height=""!=c?getCSSSize(c):"",a.style.value=dom.serializeStyle(b)}function isCssSize(a){return/^[0-9.]+(%|in|cm|mm|em|ex|pt|pc|px)$/.test(a)}function cssSize(a,b){return a=tinymce.trim(a||b),isCssSize(a)?a:parseInt(a,10)+"px"}function changedBackgroundImage(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-image"]="url('"+a.backgroundimage.value+"')",a.style.value=dom.serializeStyle(b)}function changedBorder(){var a=document.forms[0],b=dom.parseStyle(a.style.value);""==a.border.value||!isCssSize(a.border.value)&&""==a.bordercolor.value?a.border.value||(b.border="",b["border-width"]=""):b["border-width"]=cssSize(a.border.value),a.style.value=dom.serializeStyle(b)}function changedColor(){var a=document.forms[0],b=dom.parseStyle(a.style.value);b["background-color"]=a.bgcolor.value,""!=a.bordercolor.value&&(b["border-color"]=a.bordercolor.value,b["border-width"]||(b["border-width"]=cssSize(a.border.value,1))),a.style.value=dom.serializeStyle(b)}function changedStyle(){var a=document.forms[0],b=dom.parseStyle(a.style.value);a.backgroundimage.value=b["background-image"]?b["background-image"].replace(new RegExp("url\\(['\"]?([^'\"]*)['\"]?\\)","gi"),"$1"):"",b.width&&(a.width.value=trimSize(b.width)),b.height&&(a.height.value=trimSize(b.height)),b["background-color"]&&(a.bgcolor.value=b["background-color"],updateColor("bgcolor_pick","bgcolor")),b["border-color"]&&(a.bordercolor.value=b["border-color"],updateColor("bordercolor_pick","bordercolor"))}tinyMCEPopup.requireLangPack();var action,orgTableWidth,orgTableHeight,dom=tinyMCEPopup.editor.dom;tinyMCEPopup.onInit.add(init);